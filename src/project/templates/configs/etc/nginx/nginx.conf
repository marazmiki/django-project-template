# The nginx configuration file for '{{ project_name }}' project
# Automatically generated at {% now "Y-m-d H:M:S Z" %}

upstream {{ project_name }}_cluster {
    server 127.0.0.1:9000 fail_timeout=0;
}

server {
    server_tokens    off
    charset    utf-8;

    access_log   {{ CONFIG_GEN_GENERATED_DIR }}/logs/access.log;
    error_log    {{ CONFIG_GEN_GENERATED_DIR }}/logs/error.log warn;

    error_page  403  /403.html;
    error_page  404  /404.html;
    error_page  500  /500.html;
    error_page  502  /500.html;
    error_page  503  /500.html;
    error_page  504  /500.html;

    location = /403.html { root {{ CONFIG_GEN_GENERATED_DIR }}/etc/nginx; }
    location = /404.html { root {{ CONFIG_GEN_GENERATED_DIR }}/etc/nginx; }
    location = /500.html { root {{ CONFIG_GEN_GENERATED_DIR }}/etc/nginx; }


    location / {
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header    Host                $http_host;
        proxy_redirect      off;
        proxy_pass          http://{{ project_name }}_cluster;
    }

    location {{ STATIC_URL }} {
        expires max;
        access_log   off;
        alias {{ STATIC_ROOT }}/;
    }

    location {{ MEDIA_URL }} {
        client_max_body_size 1G;
        expires max;
        alias {{ MEDIA_ROOT }}/;
    }

    location = /favicon.ico {
        root {{ STATIC_ROOT }};
    }
}
